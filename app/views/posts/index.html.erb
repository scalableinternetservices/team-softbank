<%= render 'shared/header' %>

<% if user_signed_in? %>
  <% if @location == [0, 0] %>
    <p id="curloc">Computing location...</p>
    <%= javascript_tag 'postHTML5Loc()' %>
  <% else %>
    <p id="curloc">Your location: <%= @location.first %>, <%= @location.last %></p>
  <% end %>

  <%= form_tag posts_path, :method => 'get' do %>
    Sort by:
    <%= select_tag :sort, options_for_select(['closest', 'spiciest', 'freshest'].index_by(&:capitalize), @sort), :onChange=>'this.form.submit();' %>
  <% end %>

  <div id="postcards">
    <% @posts.each do |post| %>
      <%= render partial: 'shared/postcard', locals: { post: post, location: @location } %>
    <% end %>
    <ul class="pagination">
      <li class="<%= "page-item page-prev #{@posts_page > 1 ? "" : "disabled"}" %>">
        <%= link_to "Previous posts", posts_path(posts_page: @posts_page - 1), class: "page-item-title h5" %>
      </li>
      <li class="<%= "page-item page-next #{@posts_page < @posts_page_max ? "" : "disabled"}" %>">
        <%= link_to "Next posts", posts_path(posts_page: @posts_page + 1), class: "page-item-title h5" %>
      </li>
    </ul>
  </div>
<% else %>
  <%= render 'shared/notsignedin' %>
<% end %>
