<%= render 'shared/header' %>

<% if @post.publicly_viewable? %>
  <%= render partial: 'postbody', locals: { post: @post, comments: @comments, location: nil } %>
<% elsif !user_signed_in? %>
  <%= render 'shared/notsignedin' %>
<% elsif @post.user_id == current_user.id || @post.within?(@location) %>
  <%= render partial: 'postbody', locals: { post: @post, comments: @comments, location: @location } %>
<% else %>
  <%# fetch user loc? %>
  <%# or maybe we can just be lazy: user will sign in, get redirected to /posts, and obtain location %>
  <%# instead of redirecting back to the post itself %>
  <%# this laziness doesn't work if user is signed in and tries to go to a post directly! %>
  <%= render partial: 'shared/unviewable' %>
<% end %>
